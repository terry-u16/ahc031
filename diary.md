# AHC031日記

文章書こうとすると続かないことがAHC030で判明したので箇条書きで書いていくよ

## 1日目（金）

- 2次元ムズい。ギロチンカット問題を考えて縦横に再帰的に分割する？
  - 上手くパーティションを共有出来る気がしない
- 考察のためまずは1次元を……1次元でよくね？
- クソ雑に焼いて提出。13.241Bで17位
- スペース不足ペナルティ、問題文読んだときの直感よりかなり重いな……
- 空きスペース、最小で5%あると思ったら0.25%だった。きっつい
  - 1次元だと毎回パーティション配置し直してもスペース不足ペナルティに引っかかる
- 本当に1次元だと弱そう
  - 微調整が効かない
  - 1つ動かすときに長さ1000のパーティションの削除と追加が発生する
  - 実行時間100倍にしてみたけど相対スコア2倍が関の山だなあ
- 一方でガチ2次元は手に負えない。縦にいくつか分割したそれぞれで1次元的に考える1.5次元スタイルはどうか
  - ビンパッキングっぽい問題になる
- 意外とビムサ使えたりしない？焼きなましだと途中をいじったときの後ろへの影響が大きい
  - ビムサはビムサで次の手の選び方がムズい
  - 一部いじったときのマッチングを高速に計算できたりしない？
  - ビムサの1手を山登りで作れたりしない？
- ビンパッキングと考えるとa_{d,i}+a_{d,j}≒a_{d+1,k}みたいなのを上手く作って繋げていく問題になったりしない？
  - 隣接要素同士でないと分割・マージができないのがネック
  - 2段階で解けたりしない？
- 各a_{d,i}の分布は見ておきたい

## 2日目（土）

- a_{d,i}の分布見ようとしてようやく気付いたけどこれAHC025（天秤のやつ）感あるな
- 縦に分割して1.5次元だとパーティションが長くなりがちか
  - 縦横に再帰的に分割するとパーティションの長さが短くできるはず
  - 二分木っぽくすると良い？
- 黄金比？別に変わらんか
  - 焼きなましくんにお任せ
- 二分木状にするとして、どう分割するかはdpでできそう
- 二分木のやつ、とりあえずdpだけやった
  - それっぽく分割できるように見える
  - 白赤の横長長方形が上下に並ぶとポーランドの国旗にしか見えねえ
    - [ポーランド](https://ja.wikipedia.org/wiki/%E3%83%9D%E3%83%BC%E3%83%A9%E3%83%B3%E3%83%89)
    - だいたいHoI4のせい
    - そういやPsyhoさんもポーランドか
- 長方形の配置順、結構影響しそうな気がするけどどうすればいいかよく分からん
  - 相関係数を見たところ、kの差が小さいと相関係数が正に、kの差が大きいと相関係数が負になった。まあ直感通りか
- 実装方針がムズい
  - できた
- がんばって実装する
  - 思ったよりバグらせなかった
  - 初期解からだいぶズレて意図しない形になってるな
  - 相対スコアは4倍ちょっとくらいになりそう
- 気付いたら3.383Bで97位まで落ちてた
  - 15.704Bで11位。悪くはないが……
  - 1位は40Bなので全然届かない
- ここからあんまり伸びる気がしないなあ
  - 実行時間10倍にしても2割改善がいいとこ
  - AHC025みたいに小さいやつで微調整するのがやりたい
  - どうやって実現するかというアイデアはない……
- 二分木じゃなくてN分木の方が良いこともあるかも。メモ
  - 木の深さが浅くなるので、一部調整したいときに変更箇所が少なくて済むかも
- やっぱりビムサ系の方が良いかもなあ
  - まずは貪欲からか。明日考える

## 3日目（日）

- 進捗ありません
- まとまった時間が取れなかったので移動中とかに考察してたけど、やっぱり木構造で管理するのは無理がありそう
- k=1,2,...,Nのうち、小～真ん中辺りはそんなに大きく変わらないはず。大きい方は変化せざるを得ない
- 1次元でも幅を十分狭くすれば良い線行くんじゃないか？やっぱりビンパッキング的なイメージ
- ヘビ状にするともう少し自由度が上がる？でも実装がかなり難しそう
- 2次元を解く前に前に1次元が解けないとどうにもならんし先に1次元解いてみるか？
- ソート済み配列のうち高々定数個を変更した場合、再ソートはO(N)でできるはず
  - マージソートより良い方法ある？メモリ確保不要だと嬉しいが……
- ビンパッキングのビンを作る実験コードを実装した
  - ビンの大きさ（というか仕切りの位置）を焼きなまして、適当にbest-fitで収まるかチェック
  - 極端にNが小さく/eが小さくない限りまあまあ仕切りを作れそう？
  - 仕切りを作れれば良いというわけでもなく難しいが……
  - これベースで1日ごとに焼くgreedyを実装してみるか

## 4日目（月）

- 1日ごとに焼くgreedyを実装した
  - イベントホールを縦にK分割したとき、N-K本の横線が引かれることになるのでその位置を焼きなまし
- 30,736Bで3位。よしよし
- 1手先をほんのり読むと微妙に改善したような気もするけどよく分からん
- 他にも小手先改善を入れたがあまり変わらず。まだあんまりちまちました改善入れない方が良いな
- 1位のスコアは1.5倍くらい。まだまだコンテスト序盤だし今の2倍くらいにするつもりじゃないと勝てなさそう
- 横線の位置を解表現にしてるけどイマイチだったりする？
  - binごとに予約の集合を持ったらそこから最適な配置が求められたりしないかな

## 5日目（火）

- 1日ごとではなく、全日分まとめて焼いてみる
  - seed=0はともかく、それ以外の多くで悪化したのでボツ
- 面積スコアを時間とともに変化させてみる
  - あんま変わらないのでボツ
- 解の持ち方を変えてみる
  - 横棒の位置を持つのではなく、どのレーンに何番目の長方形が来るかを持つ
  - レーンごとの長方形の集合が決まったとき、最適な配置はbit DPで求められる
  - DP死ぬほどバグらせた。2時間くらいバグってたと思う
  - 回してみると全然ダメ。2時間を返してくれ
- 結局幅の広いレーンの使い方を効率化しないとダメそう
- 一番幅の広いレーンが狭いほどボーナスが付くようにした。微妙に改善してはいるけど本当に微妙……

## 6日目（水）

- 今日はあまり時間が取れそうにない……
- 現在23.705Bで6位。1位は40.005Gなのでやっぱり最低限2倍にする必要はある
  - まだメタ焼きなましの温度を下げる時間じゃないのでいろんな解法のPoCを続行する
- なんだかんだ6位ではあるので事前にレーン分割する方針は悪くないように思うが、その後の割り振り方がよろしくない気がする
- できるだけ幅の広いレーンは使いたくない。細いレーンから順番に使っていくfirst-fitが意外と使えたりしない？
  - レーン幅・本数を焼きなまして、first-fitで埋めていくやつを試してみる
- 雑に実装。1日前のラインとの整合性は無視
- 全体的にレーンを細くできている。なんとなく焼きやすい感覚もある
- seed=0はかなり良くなったが、seed=1とかは悪化
  - 一番太いレーンに小さい面積の要求がたくさん来てしまっているのが原因
- 各リクエストごとに右から探索するか左から探索するかのフラグを持たせて、それもまとめて焼きなます
  - 今まで作っていた解法と同じくらいまで改善した
- ただここからの改善はあまり望めなさそうに見える
  - 少なくともコストが半分になりそうには見えない
  - レーン方式の限界か……？

## 7日目（木）

- 何もしてない

## 8日目（金）

- 全然良い案が思い付かん……
- ビムサ？
  - 日付は対称性があるため、前からのビムサと後ろからのビムサの両方やっても良さそう
- ビムサするにしても効率的な山登りが必要
- 面積が足りない長方形を別のものとマージ&長方形をどこかから切り出すという近傍はどうか
  - なんか上手く行かないケースもありそうだけど、このままだと勝てないしとりあえず実装してみよう
- 今日は考察だけで終わった。実装は明日
  - 気付いたら月曜から何も進まず16位でやばい……

## 9日目（土）

## 10日目（日）

- 26,581B / 13位
- 28,234B / 10位
- 29,321B / 8位
- 29,830B / 7位
- 31,027B / 6位
- 32,141B / 4位
- 33,115B / 4位

## 11日目（月）

- 暫定6位で耐え
- システスでなんか5位になった
